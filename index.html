<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Relatório (JS)</title>
    <style>
        /* CSS do seu projeto (inalterado) */
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        h2, h3, h4 { color: #333; }
        form { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        div { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], textarea {
            width: 95%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-family: Arial, sans-serif;
        }
        .equip-grid-2-col input[type="text"] {
             width: 90%;
        }
        textarea { height: 100px; }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover { background-color: #0056b3; }
        button.add-equip {
            background-color: #28a745;
            font-size: 14px;
            padding: 8px 12px;
            margin-top: 10px;
        }
        button.add-equip:hover { background-color: #218838; }
        button.remove-equip {
            background-color: #dc3545;
            padding: 5px 10px;
            font-size: 12px;
            float: right; 
        }
        button.remove-equip:hover { background-color: #c82333; }
        pre {
            background-color: #eee;
            border: 1px dashed #ccc;
            padding: 15px;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: monospace;
            font-size: 14px;
        }
        .equip-bloco {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            background: #fdfdfd;
            position: relative;
        }
        .equip-grid-2-col {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        .equip-grid-2-col div {
            margin-bottom: 0;
        }
    </style>
</head>
<body>

    <h2>Gerador de Relatório de Manutenção</h2>
    <p>Preencha os campos abaixo para gerar o relatório padronizado.</p>

    <form id="relatorio-form"> 
        <div>
            <label for="data_manutencao">Data da Manutenção (ex: 17/10/25):</label>
            <input type="text" id="data_manutencao" name="data_manutencao" required>
        </div>
        <div>
            <label for="executantes">Executantes (um por linha):</label>
            <textarea id="executantes" name="executantes" rows="3"></textarea>
        </div>

        <hr>
        <h3>Equipamentos</h3>
        
        <div id="equipamentos-container">
            </div>
        
        <button type="button" class="add-equip" onclick="addEquipamento()">
            + Adicionar Equipamento
        </button>
        
        <hr>
        
        <div>
            <label for="justificativa_obs">Observações Gerais:</label>
            <textarea id="justificativa_obs" name="justificativa_obs"></textarea>
        </div>

        <button type="button" onclick="gerarRelatorio()">Gerar Relatório</button>
    </form>

    <h3>Relatório Gerado (Pronto para Copiar):</h3>
    <pre id="relatorio-final"></pre>


    <script>
        let uniqueEquipId = 0; // ID único para garantir a referência correta no DOM

        function addEquipamento() {
            uniqueEquipId++;
            const currentId = uniqueEquipId; // Usa o ID único atual
            const container = document.getElementById('equipamentos-container');
            const newEquip = document.createElement('div');
            newEquip.className = 'equip-bloco';
            // Usa o ID único como o ID do bloco
            newEquip.id = `equipamento-${currentId}`; 
            
            newEquip.innerHTML = `
                <h4>
                    Equipamento #${currentId}
                    <button type="button" class="remove-equip" onclick="removeEquipamento(${currentId})">
                        Remover
                    </button>
                </h4>
                
                <div class="equip-grid-2-col">
                    <div>
                        <label for="equip_nome_${currentId}">Nome do Equipamento (digitar ou clicar para ver opções):</label>
                        <input type="text" id="equip_nome_${currentId}" name="equip_nome_${currentId}" placeholder="Ex: PF1146" list="lista-equipamentos">
                    </div>
                    <div>
                        <label for="equip_realizado_${currentId}">Realizado (%):</label>
                        <input type="text" id="equip_realizado_${currentId}" name="equip_realizado_${currentId}" value="100%">
                    </div>
                </div>

                <div>
                    <label for="atividades_${currentId}">Atividades Realizadas:</label>
                    <textarea id="atividades_${currentId}" name="atividades_${currentId}"></textarea>
                </div>
                <div>
                    <label for="pendencias_${currentId}">Pendências:</label>
                    <textarea id="pendencias_${currentId}" name="pendencias_${currentId}"></textarea>
                </div>
            `;
            container.appendChild(newEquip);
        }
        
        function removeEquipamento(id) {
            const equipBloco = document.getElementById(`equipamento-${id}`);
            if (equipBloco) {
                equipBloco.remove();
            }
        }

        // --- NOVA FUNÇÃO: GERAÇÃO DO RELATÓRIO EM JAVASCRIPT ---
        function gerarRelatorio() {
            // 1. Coletar dados gerais
            const data = document.getElementById('data_manutencao').value;
            const executantes = document.getElementById('executantes').value;
            const justificativaObs = document.getElementById('justificativa_obs').value;

            // 2. Coletar dados dos equipamentos
            let atividadesTexto = "";
            let pendenciasTexto = "";
            
            // Pega todos os blocos de equipamento atualmente no DOM
            const equipamentos = document.querySelectorAll('#equipamentos-container .equip-bloco');

            equipamentos.forEach(bloco => {
                // Pega o ID único do bloco para buscar os inputs
                const id = bloco.id.split('-')[1]; 

                // Acessa os campos usando o ID
                const nomeInput = document.getElementById(`equip_nome_${id}`);
                const realizadoInput = document.getElementById(`equip_realizado_${id}`);
                const atividadesInput = document.getElementById(`atividades_${id}`);
                const pendenciasInput = document.getElementById(`pendencias_${id}`);

                const nome = nomeInput ? nomeInput.value.trim() : '';
                const realizadoPerc = realizadoInput ? realizadoInput.value.replace('%', '').trim() : '100';
                const atividade = atividadesInput ? atividadesInput.value.trim() : '';
                const pendencia = pendenciasInput ? pendenciasInput.value.trim() : '';

                if (nome) {
                    const nomeUpper = nome.toUpperCase(); 
                    
                    if (atividade) {
                        atividadesTexto += `${nomeUpper} (Realizado: ${realizadoPerc}%):\n${atividade}\n\n`;
                    }
                    
                    if (pendencia) {
                        pendenciasTexto += `${nomeUpper}:\n${pendencia}\n\n`;
                    }
                }
            });

            // 3. Montar o relatório final
            const relatorioFinal = `
MANUTENÇÃO PREVENTIVA - ${data}

Executantes:
${executantes}
------------------------------------
Atividades realizadas:
${atividadesTexto.trim()}

------------------------------------
Pendências
${pendenciasTexto.trim()}
-----------------------------------------
OBSERVAÇÕES GERAIS
${justificativaObs}
-----------------------------------------
`;
            
            // 4. Injetar o relatório no elemento <pre>
            document.getElementById('relatorio-final').textContent = relatorioFinal.trim();
        }
        // --- FIM NOVA FUNÇÃO ---
    </script>
    
    <datalist id="lista-equipamentos">
        <option value="PF1105">
        <option value="PF1111">
        <option value="PF1115">
        <option value="PF1120">
        <option value="PF1140">
        <option value="PF1142">
        <option value="PF1144">
        <option value="PF1145"> 
        <option value="PF1146">
        <option value="PF1147">
        <option value="PF1148">
        <option value="PF6750">
    </datalist>

</body>
</html>
